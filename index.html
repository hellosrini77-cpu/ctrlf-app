<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CtrlF â€” Ctrl+F for your company</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600;700&family=Plus+Jakarta+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-primary: #0a0a0b;
            --bg-secondary: #111113;
            --bg-tertiary: #1a1a1d;
            --text-primary: #fafafa;
            --text-secondary: #a1a1aa;
            --text-muted: #71717a;
            --accent: #22d3ee;
            --accent-glow: rgba(34, 211, 238, 0.15);
            --accent-hover: #06b6d4;
            --border: #27272a;
            --kbd-bg: #18181b;
            --kbd-border: #3f3f46;
            --success: #4ade80;
            --error: #f87171;
            --warning: #fbbf24;
            --font-mono: 'JetBrains Mono', monospace;
            --font-sans: 'Plus Jakarta Sans', sans-serif;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: var(--font-sans);
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
            overflow-x: hidden;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-image: 
                linear-gradient(rgba(34, 211, 238, 0.03) 1px, transparent 1px),
                linear-gradient(90deg, rgba(34, 211, 238, 0.03) 1px, transparent 1px);
            background-size: 60px 60px;
            pointer-events: none;
            z-index: 0;
        }

        .gradient-orb {
            position: fixed;
            top: -200px;
            right: -200px;
            width: 600px;
            height: 600px;
            background: radial-gradient(circle, rgba(34, 211, 238, 0.08) 0%, transparent 70%);
            pointer-events: none;
            z-index: 0;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 24px;
            position: relative;
            z-index: 1;
        }

        /* Header */
        header {
            padding: 24px 0;
            position: relative;
            z-index: 10;
        }

        .header-inner {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 8px;
            font-family: var(--font-mono);
            font-weight: 700;
            font-size: 1.5rem;
            color: var(--text-primary);
            text-decoration: none;
        }

        .logo-keys {
            display: flex;
            gap: 4px;
        }

        .key {
            background: var(--kbd-bg);
            border: 1px solid var(--kbd-border);
            border-radius: 6px;
            padding: 4px 8px;
            font-size: 0.875rem;
            font-family: var(--font-mono);
            box-shadow: 0 2px 0 var(--kbd-border);
        }

        .key.accent {
            background: var(--accent);
            color: var(--bg-primary);
            border-color: var(--accent);
            box-shadow: 0 2px 0 var(--accent-hover), 0 0 20px var(--accent-glow);
        }

        nav {
            display: flex;
            gap: 32px;
            align-items: center;
        }

        nav a {
            color: var(--text-secondary);
            text-decoration: none;
            font-size: 0.9rem;
            transition: color 0.2s;
        }

        nav a:hover {
            color: var(--text-primary);
        }

        .btn {
            background: var(--accent);
            color: var(--bg-primary);
            padding: 10px 20px;
            border-radius: 8px;
            font-weight: 600;
            font-size: 0.9rem;
            text-decoration: none;
            transition: all 0.2s;
            border: none;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn:hover {
            background: var(--accent-hover);
            transform: translateY(-1px);
            box-shadow: 0 4px 20px var(--accent-glow);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .btn-outline {
            background: transparent;
            border: 1px solid var(--border);
            color: var(--text-primary);
        }

        .btn-outline:hover {
            border-color: var(--accent);
            background: var(--accent-glow);
        }

        .btn-google {
            background: #fff;
            color: #333;
        }

        .btn-google:hover {
            background: #f5f5f5;
        }

        /* User info */
        .user-info {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .user-avatar {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            border: 2px solid var(--accent);
        }

        .user-name {
            font-size: 0.9rem;
            color: var(--text-secondary);
        }

        /* Hero */
        .hero {
            padding: 80px 0 60px;
            text-align: center;
        }

        .hero-badge {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            padding: 8px 16px;
            border-radius: 100px;
            font-size: 0.85rem;
            color: var(--text-secondary);
            margin-bottom: 32px;
        }

        .hero-badge .dot {
            width: 8px;
            height: 8px;
            background: var(--success);
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        h1 {
            font-size: clamp(3rem, 8vw, 5rem);
            font-weight: 700;
            line-height: 1.1;
            margin-bottom: 24px;
            letter-spacing: -0.02em;
        }

        h1 .highlight {
            background: linear-gradient(135deg, var(--accent), #a78bfa);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .hero-subtitle {
            font-size: 1.25rem;
            color: var(--text-secondary);
            max-width: 600px;
            margin: 0 auto 48px;
            line-height: 1.6;
        }

        /* Search Demo */
        .search-demo {
            max-width: 700px;
            margin: 0 auto 40px;
        }

        .search-container {
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 8px;
            display: flex;
            align-items: center;
            gap: 12px;
            transition: all 0.3s;
        }

        .search-container:focus-within {
            border-color: var(--accent);
            box-shadow: 0 0 0 4px var(--accent-glow), 0 20px 40px rgba(0,0,0,0.3);
        }

        .search-icon {
            padding: 12px;
            color: var(--text-muted);
        }

        .search-input {
            flex: 1;
            background: none;
            border: none;
            font-size: 1.1rem;
            color: var(--text-primary);
            font-family: var(--font-sans);
            outline: none;
        }

        .search-input::placeholder {
            color: var(--text-muted);
        }

        .search-shortcut {
            display: flex;
            gap: 4px;
            padding-right: 8px;
        }

        .search-shortcut .key {
            font-size: 0.75rem;
            padding: 4px 8px;
        }

        .search-hint {
            text-align: center;
            margin-top: 16px;
            color: var(--text-muted);
            font-size: 0.85rem;
        }

        /* Search filters */
        .search-filters {
            display: flex;
            justify-content: center;
            gap: 12px;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        .filter-chip {
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 100px;
            padding: 8px 16px;
            font-size: 0.85rem;
            color: var(--text-secondary);
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .filter-chip:hover {
            border-color: var(--accent);
            color: var(--text-primary);
        }

        .filter-chip.active {
            background: var(--accent-glow);
            border-color: var(--accent);
            color: var(--accent);
        }

        .filter-chip svg {
            width: 16px;
            height: 16px;
        }

        /* AI Answer */
        .ai-answer {
            max-width: 800px;
            margin: 0 auto 24px;
            background: linear-gradient(135deg, rgba(34, 211, 238, 0.1), rgba(168, 85, 247, 0.1));
            border: 1px solid rgba(34, 211, 238, 0.3);
            border-radius: 12px;
            padding: 20px;
        }

        .ai-answer-header {
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: 600;
            color: var(--accent);
            margin-bottom: 12px;
        }

        .ai-icon {
            font-size: 1.2rem;
        }

        .ai-answer-content {
            color: var(--text-primary);
            line-height: 1.6;
            font-size: 1rem;
        }

        .ai-answer-sources {
            margin-top: 12px;
            padding-top: 12px;
            border-top: 1px solid var(--border);
            font-size: 0.85rem;
            color: var(--text-secondary);
        }

        .ai-loading {
            display: flex;
            align-items: center;
            gap: 8px;
            color: var(--text-secondary);
        }

        .ai-loading .spinner {
            width: 16px;
            height: 16px;
        }

        /* Results */
        .results-container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px 0;
            display: none;
        }

        .results-container.visible {
            display: block;
        }

        .results-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 16px;
            border-bottom: 1px solid var(--border);
        }

        .results-count {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        .results-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .result-item {
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 16px 20px;
            transition: all 0.2s;
            cursor: pointer;
            text-decoration: none;
            display: block;
        }

        .result-item:hover {
            border-color: var(--accent);
            transform: translateX(4px);
        }

        .result-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 8px;
        }

        .result-icon {
            font-size: 1.5rem;
        }

        .result-source {
            font-size: 0.75rem;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.05em;
            background: var(--bg-tertiary);
            padding: 4px 8px;
            border-radius: 4px;
        }

        .result-source.drive {
            color: var(--success);
        }

        .result-source.gmail {
            color: #EA4335;
        }

        .result-source.notion {
            color: #fff;
        }

        .result-source.slack {
            color: #E01E5A;
        }

        .result-title {
            font-weight: 600;
            color: var(--text-primary);
            font-size: 1rem;
            margin-bottom: 4px;
        }

        .result-snippet {
            color: var(--text-secondary);
            font-size: 0.9rem;
            line-height: 1.5;
        }

        .result-meta {
            display: flex;
            gap: 16px;
            margin-top: 8px;
            font-size: 0.8rem;
            color: var(--text-muted);
        }

        /* Loading */
        .loading {
            display: none;
            text-align: center;
            padding: 40px;
            color: var(--text-secondary);
        }

        .loading.visible {
            display: block;
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 3px solid var(--border);
            border-top-color: var(--accent);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 16px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Auth section */
        .auth-section {
            text-align: center;
            margin-top: 30px;
        }

        .auth-section p {
            color: var(--text-secondary);
            margin-bottom: 16px;
        }

        /* Waitlist form */
        .waitlist-form {
            max-width: 400px;
            margin: 0 auto;
            display: flex;
            gap: 12px;
        }

        .waitlist-input {
            flex: 1;
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 12px 16px;
            font-size: 1rem;
            color: var(--text-primary);
            font-family: var(--font-sans);
            outline: none;
        }

        .waitlist-input:focus {
            border-color: var(--accent);
        }

        .waitlist-input::placeholder {
            color: var(--text-muted);
        }

        .waitlist-success {
            color: var(--success);
            margin-top: 12px;
            display: none;
        }

        .waitlist-success.visible {
            display: block;
        }

        /* Integrations */
        .integrations {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 48px;
            padding: 40px 0;
            border-top: 1px solid var(--border);
            border-bottom: 1px solid var(--border);
            margin-bottom: 80px;
            flex-wrap: wrap;
        }

        .integrations-label {
            color: var(--text-muted);
            font-size: 0.85rem;
            text-transform: uppercase;
            letter-spacing: 0.1em;
        }

        .integration-icons {
            display: flex;
            gap: 32px;
            align-items: center;
            flex-wrap: wrap;
            justify-content: center;
        }

        .integration-icon {
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0.6;
            transition: all 0.2s;
            cursor: pointer;
        }

        .integration-icon:hover {
            opacity: 1;
            transform: scale(1.1);
        }

        .integration-icon svg {
            width: 32px;
            height: 32px;
        }

        /* Features */
        .features {
            padding: 80px 0;
        }

        .section-header {
            text-align: center;
            margin-bottom: 60px;
        }

        .section-header h2 {
            font-size: 2.5rem;
            margin-bottom: 16px;
        }

        .section-header p {
            color: var(--text-secondary);
            font-size: 1.1rem;
        }

        .features-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 24px;
        }

        .feature-card {
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 32px;
            transition: all 0.3s;
        }

        .feature-card:hover {
            border-color: var(--accent);
            transform: translateY(-4px);
            box-shadow: 0 20px 40px rgba(0,0,0,0.2);
        }

        .feature-icon {
            width: 48px;
            height: 48px;
            background: var(--accent-glow);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 20px;
            color: var(--accent);
        }

        .feature-card h3 {
            font-size: 1.25rem;
            margin-bottom: 12px;
        }

        .feature-card p {
            color: var(--text-secondary);
            line-height: 1.6;
        }

        /* How it works */
        .how-it-works {
            padding: 80px 0;
        }

        .steps {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 40px;
            margin-top: 60px;
        }

        .step {
            text-align: center;
        }

        .step-number {
            width: 60px;
            height: 60px;
            background: var(--bg-tertiary);
            border: 2px solid var(--accent);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: var(--font-mono);
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--accent);
            margin: 0 auto 20px;
        }

        .step h3 {
            font-size: 1.25rem;
            margin-bottom: 12px;
        }

        .step p {
            color: var(--text-secondary);
            line-height: 1.6;
        }

        /* CTA */
        .cta {
            padding: 100px 0;
            text-align: center;
        }

        .cta-box {
            background: linear-gradient(135deg, var(--bg-secondary), var(--bg-tertiary));
            border: 1px solid var(--border);
            border-radius: 24px;
            padding: 60px;
            position: relative;
            overflow: hidden;
        }

        .cta-box::before {
            content: '';
            position: absolute;
            top: -100px;
            left: 50%;
            transform: translateX(-50%);
            width: 400px;
            height: 400px;
            background: radial-gradient(circle, var(--accent-glow) 0%, transparent 70%);
            pointer-events: none;
        }

        .cta-box h2 {
            font-size: 2.5rem;
            margin-bottom: 16px;
            position: relative;
        }

        .cta-box p {
            color: var(--text-secondary);
            font-size: 1.1rem;
            margin-bottom: 32px;
            position: relative;
        }

        .cta-buttons {
            display: flex;
            gap: 16px;
            justify-content: center;
            position: relative;
            flex-wrap: wrap;
        }

        /* Footer */
        footer {
            padding: 40px 0;
            border-top: 1px solid var(--border);
            text-align: center;
            color: var(--text-muted);
            font-size: 0.85rem;
        }

        footer a {
            color: var(--text-secondary);
            text-decoration: none;
        }

        footer a:hover {
            color: var(--accent);
        }

        /* Toast notifications */
        .toast {
            position: fixed;
            bottom: 24px;
            right: 24px;
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 16px 24px;
            display: flex;
            align-items: center;
            gap: 12px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
            transform: translateY(100px);
            opacity: 0;
            transition: all 0.3s;
            z-index: 100;
        }

        .toast.visible {
            transform: translateY(0);
            opacity: 1;
        }

        .toast.success {
            border-color: var(--success);
        }

        .toast.error {
            border-color: var(--error);
        }

        /* Responsive */
        @media (max-width: 768px) {
            nav {
                display: none;
            }

            .hero {
                padding: 60px 0 40px;
            }

            .integrations {
                gap: 24px;
            }

            .integration-icons {
                gap: 20px;
            }

            .cta-box {
                padding: 40px 24px;
            }

            .cta-buttons {
                flex-direction: column;
            }

            .waitlist-form {
                flex-direction: column;
            }
        }

        /* Hidden state */
        .hidden {
            display: none !important;
        }
    </style>
</head>
<body>
    <div class="gradient-orb"></div>
    
    <header>
        <div class="container">
            <div class="header-inner">
                <a href="/" class="logo">
                    <div class="logo-keys">
                        <span class="key">Ctrl</span>
                        <span class="key accent">F</span>
                    </div>
                </a>
                <nav>
                    <a href="#features">Features</a>
                    <a href="#how-it-works">How it works</a>
                    <div id="authButtons">
                        <button onclick="signInWithGoogle()" class="btn btn-google">
                            <svg width="18" height="18" viewBox="0 0 24 24">
                                <path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/>
                                <path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/>
                                <path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/>
                                <path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/>
                            </svg>
                            Sign in with Google
                        </button>
                    </div>
                    <div id="userInfo" class="user-info hidden">
                        <img id="userAvatar" class="user-avatar" src="" alt="">
                        <span id="userName" class="user-name"></span>
                        <button onclick="signOut()" class="btn btn-outline">Sign out</button>
                    </div>
                </nav>
            </div>
        </div>
    </header>

    <main>
        <section class="hero">
            <div class="container">
                <div class="hero-badge">
                    <span class="dot"></span>
                    Now in beta
                </div>
                <h1>
                    <span class="highlight">Ctrl+F</span> for<br>your company
                </h1>
                <p class="hero-subtitle">
                    Search across Google Drive, Notion, Gmail, and more â€” all from one place. 
                    Find anything in seconds, not hours.
                </p>
                
                <div class="search-demo">
                    <div class="search-container">
                        <div class="search-icon">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <circle cx="11" cy="11" r="8"></circle>
                                <path d="m21 21-4.3-4.3"></path>
                            </svg>
                        </div>
                        <input type="text" id="searchInput" class="search-input" placeholder="Search across all your apps...">
                        <div class="search-shortcut">
                            <span class="key">âŒ˜</span>
                            <span class="key">K</span>
                        </div>
                    </div>
                    
                    <div class="search-filters" id="searchFilters">
                        <button class="filter-chip active" data-source="all">
                            All
                        </button>
                        <button class="filter-chip" data-source="drive">
                            <svg viewBox="0 0 87.3 78" xmlns="http://www.w3.org/2000/svg">
                                <path d="m6.6 66.85 3.85 6.65c.8 1.4 1.95 2.5 3.3 3.3l13.75-23.8h-27.5c0 1.55.4 3.1 1.2 4.5z" fill="#0066da"/>
                                <path d="m43.65 25-13.75-23.8c-1.35.8-2.5 1.9-3.3 3.3l-25.4 44a9.06 9.06 0 0 0 -1.2 4.5h27.5z" fill="#00ac47"/>
                                <path d="m73.55 76.8c1.35-.8 2.5-1.9 3.3-3.3l1.6-2.75 7.65-13.25c.8-1.4 1.2-2.95 1.2-4.5h-27.502l5.852 11.5z" fill="#ea4335"/>
                                <path d="m43.65 25 13.75-23.8c-1.35-.8-2.9-1.2-4.5-1.2h-18.5c-1.6 0-3.15.45-4.5 1.2z" fill="#00832d"/>
                                <path d="m59.8 53h-32.3l-13.75 23.8c1.35.8 2.9 1.2 4.5 1.2h50.8c1.6 0 3.15-.45 4.5-1.2z" fill="#2684fc"/>
                                <path d="m73.4 26.5-12.7-22c-.8-1.4-1.95-2.5-3.3-3.3l-13.75 23.8 16.15 28h27.45c0-1.55-.4-3.1-1.2-4.5z" fill="#ffba00"/>
                            </svg>
                            Drive
                        </button>
                        <button class="filter-chip" data-source="gmail">
                            <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                <path d="M24 5.457v13.909c0 .904-.732 1.636-1.636 1.636h-3.819V11.73L12 16.64l-6.545-4.91v9.273H1.636A1.636 1.636 0 0 1 0 19.366V5.457c0-2.023 2.309-3.178 3.927-1.964L5.455 4.64 12 9.548l6.545-4.91 1.528-1.145C21.69 2.28 24 3.434 24 5.457z" fill="#EA4335"/>
                            </svg>
                            Gmail
                        </button>
                        <button class="filter-chip" data-source="notion">
                            <svg viewBox="0 0 100 100" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M6.017 4.313l55.333 -4.087c6.797 -0.583 8.543 -0.19 12.817 2.917l17.663 12.443c2.913 2.14 3.883 2.723 3.883 5.053v68.243c0 4.277 -1.553 6.807 -6.99 7.193L24.467 99.967c-4.08 0.193 -6.023 -0.39 -8.16 -3.113L3.3 79.94c-2.333 -3.113 -3.3 -5.443 -3.3 -8.167V11.113c0 -3.497 1.553 -6.413 6.017 -6.8z" fill="#fff"/>
                                <path fill-rule="evenodd" clip-rule="evenodd" d="M61.35 0.227l-55.333 4.087C1.553 4.7 0 7.617 0 11.113v60.66c0 2.723 0.967 5.053 3.3 8.167l13.007 16.913c2.137 2.723 4.08 3.307 8.16 3.113l64.257 -3.89c5.433 -0.387 6.99 -2.917 6.99 -7.193V20.64c0 -2.21 -0.873 -2.847 -3.443 -4.733L74.167 3.143c-4.273 -3.107 -6.02 -3.5 -12.817 -2.917zM25.92 19.523c-5.247 0.353 -6.437 0.433 -9.417 -1.99L8.927 11.507c-0.77 -0.78 -0.383 -1.753 1.557 -1.947l53.193 -3.887c4.467 -0.39 6.793 1.167 8.54 2.527l9.123 6.61c0.39 0.197 1.36 1.36 0.193 1.36l-54.933 3.307 -0.68 0.047zM19.803 88.3V30.367c0 -2.53 0.777 -3.697 3.103 -3.893L86 22.78c2.14 -0.193 3.107 1.167 3.107 3.693v57.547c0 2.53 -0.39 4.67 -3.883 4.863l-60.377 3.5c-3.493 0.193 -5.043 -0.97 -5.043 -4.083z" fill="#000"/>
                            </svg>
                            Notion
                        </button>
                        <button class="filter-chip" data-source="slack">
                            <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                <path d="M5.042 15.165a2.528 2.528 0 0 1-2.52 2.523A2.528 2.528 0 0 1 0 15.165a2.527 2.527 0 0 1 2.522-2.52h2.52v2.52zM6.313 15.165a2.527 2.527 0 0 1 2.521-2.52 2.527 2.527 0 0 1 2.521 2.52v6.313A2.528 2.528 0 0 1 8.834 24a2.528 2.528 0 0 1-2.521-2.522v-6.313zM8.834 5.042a2.528 2.528 0 0 1-2.521-2.52A2.528 2.528 0 0 1 8.834 0a2.528 2.528 0 0 1 2.521 2.522v2.52H8.834zM8.834 6.313a2.528 2.528 0 0 1 2.521 2.521 2.528 2.528 0 0 1-2.521 2.521H2.522A2.528 2.528 0 0 1 0 8.834a2.528 2.528 0 0 1 2.522-2.521h6.312zM18.956 8.834a2.528 2.528 0 0 1 2.522-2.521A2.528 2.528 0 0 1 24 8.834a2.528 2.528 0 0 1-2.522 2.521h-2.522V8.834zM17.688 8.834a2.528 2.528 0 0 1-2.523 2.521 2.527 2.527 0 0 1-2.52-2.521V2.522A2.527 2.527 0 0 1 15.165 0a2.528 2.528 0 0 1 2.523 2.522v6.312zM15.165 18.956a2.528 2.528 0 0 1 2.523 2.522A2.528 2.528 0 0 1 15.165 24a2.527 2.527 0 0 1-2.52-2.522v-2.522h2.52zM15.165 17.688a2.527 2.527 0 0 1-2.52-2.523 2.526 2.526 0 0 1 2.52-2.52h6.313A2.527 2.527 0 0 1 24 15.165a2.528 2.528 0 0 1-2.522 2.523h-6.313z" fill="#E01E5A"/>
                            </svg>
                            Slack
                        </button>
                    </div>
                    
                    <p class="search-hint" id="searchHint">Try: "Q4 marketing deck" or "invoice from Acme Corp"</p>
                </div>

                <!-- Loading state -->
                <div class="loading" id="loadingState">
                    <div class="spinner"></div>
                    <p>Searching across your apps...</p>
                </div>

                <!-- AI Answer -->
                <div class="ai-answer" id="aiAnswer" style="display: none;">
                    <div class="ai-answer-header">
                        <span class="ai-icon">âœ¨</span>
                        <span>AI Answer</span>
                    </div>
                    <div class="ai-answer-content" id="aiAnswerContent"></div>
                    <div class="ai-answer-sources" id="aiAnswerSources"></div>
                </div>

                <!-- Results -->
                <div class="results-container" id="resultsContainer">
                    <div class="results-header">
                        <span class="results-count" id="resultsCount">0 results</span>
                        <button onclick="clearResults()" class="btn btn-outline">Clear</button>
                    </div>
                    <div class="results-list" id="resultsList"></div>
                </div>

                <!-- Auth prompt for non-signed-in users -->
                <div class="auth-section" id="authPrompt">
                    <p>Sign in with Google to search your Drive and Gmail</p>
                    <button onclick="signInWithGoogle()" class="btn btn-google" style="margin-top: 16px;">
                        <svg width="18" height="18" viewBox="0 0 24 24">
                            <path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/>
                            <path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/>
                            <path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/>
                            <path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/>
                        </svg>
                        Sign in with Google
                    </button>
                </div>
            </div>
        </section>

        <section class="integrations">
            <div class="container">
                <span class="integrations-label">Connects to</span>
                <div class="integration-icons">
                    <!-- Google Drive -->
                    <div class="integration-icon" title="Google Drive">
                        <svg viewBox="0 0 87.3 78" xmlns="http://www.w3.org/2000/svg">
                            <path d="m6.6 66.85 3.85 6.65c.8 1.4 1.95 2.5 3.3 3.3l13.75-23.8h-27.5c0 1.55.4 3.1 1.2 4.5z" fill="#0066da"/>
                            <path d="m43.65 25-13.75-23.8c-1.35.8-2.5 1.9-3.3 3.3l-25.4 44a9.06 9.06 0 0 0 -1.2 4.5h27.5z" fill="#00ac47"/>
                            <path d="m73.55 76.8c1.35-.8 2.5-1.9 3.3-3.3l1.6-2.75 7.65-13.25c.8-1.4 1.2-2.95 1.2-4.5h-27.502l5.852 11.5z" fill="#ea4335"/>
                            <path d="m43.65 25 13.75-23.8c-1.35-.8-2.9-1.2-4.5-1.2h-18.5c-1.6 0-3.15.45-4.5 1.2z" fill="#00832d"/>
                            <path d="m59.8 53h-32.3l-13.75 23.8c1.35.8 2.9 1.2 4.5 1.2h50.8c1.6 0 3.15-.45 4.5-1.2z" fill="#2684fc"/>
                            <path d="m73.4 26.5-12.7-22c-.8-1.4-1.95-2.5-3.3-3.3l-13.75 23.8 16.15 28h27.45c0-1.55-.4-3.1-1.2-4.5z" fill="#ffba00"/>
                        </svg>
                    </div>
                    <!-- Notion -->
                    <div class="integration-icon" title="Notion">
                        <svg viewBox="0 0 100 100" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M6.017 4.313l55.333 -4.087c6.797 -0.583 8.543 -0.19 12.817 2.917l17.663 12.443c2.913 2.14 3.883 2.723 3.883 5.053v68.243c0 4.277 -1.553 6.807 -6.99 7.193L24.467 99.967c-4.08 0.193 -6.023 -0.39 -8.16 -3.113L3.3 79.94c-2.333 -3.113 -3.3 -5.443 -3.3 -8.167V11.113c0 -3.497 1.553 -6.413 6.017 -6.8z" fill="#fff"/>
                            <path fill-rule="evenodd" clip-rule="evenodd" d="M61.35 0.227l-55.333 4.087C1.553 4.7 0 7.617 0 11.113v60.66c0 2.723 0.967 5.053 3.3 8.167l13.007 16.913c2.137 2.723 4.08 3.307 8.16 3.113l64.257 -3.89c5.433 -0.387 6.99 -2.917 6.99 -7.193V20.64c0 -2.21 -0.873 -2.847 -3.443 -4.733L74.167 3.143c-4.273 -3.107 -6.02 -3.5 -12.817 -2.917zM25.92 19.523c-5.247 0.353 -6.437 0.433 -9.417 -1.99L8.927 11.507c-0.77 -0.78 -0.383 -1.753 1.557 -1.947l53.193 -3.887c4.467 -0.39 6.793 1.167 8.54 2.527l9.123 6.61c0.39 0.197 1.36 1.36 0.193 1.36l-54.933 3.307 -0.68 0.047zM19.803 88.3V30.367c0 -2.53 0.777 -3.697 3.103 -3.893L86 22.78c2.14 -0.193 3.107 1.167 3.107 3.693v57.547c0 2.53 -0.39 4.67 -3.883 4.863l-60.377 3.5c-3.493 0.193 -5.043 -0.97 -5.043 -4.083zm59.6 -54.827c0.387 1.75 0 3.5 -1.75 3.7l-2.91 0.577v42.773c-2.527 1.36 -4.853 2.137 -6.797 2.137 -3.107 0 -3.883 -0.973 -6.21 -3.887l-19.03 -29.94v28.967l6.02 1.363s0 3.5 -4.857 3.5l-13.39 0.777c-0.39 -0.78 0 -2.723 1.357 -3.11l3.497 -0.97v-38.3L30.48 40.667c-0.39 -1.75 0.58 -4.277 3.3 -4.473l14.367 -0.967 19.8 30.327v-26.83l-5.047 -0.58c-0.39 -2.143 1.163 -3.7 3.103 -3.89l13.4 -0.78z" fill="#000"/>
                        </svg>
                    </div>
                    <!-- Gmail -->
                    <div class="integration-icon" title="Gmail">
                        <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                            <path d="M24 5.457v13.909c0 .904-.732 1.636-1.636 1.636h-3.819V11.73L12 16.64l-6.545-4.91v9.273H1.636A1.636 1.636 0 0 1 0 19.366V5.457c0-2.023 2.309-3.178 3.927-1.964L5.455 4.64 12 9.548l6.545-4.91 1.528-1.145C21.69 2.28 24 3.434 24 5.457z" fill="#EA4335"/>
                        </svg>
                    </div>
                    <!-- Slack -->
                    <div class="integration-icon" title="Slack">
                        <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                            <path d="M5.042 15.165a2.528 2.528 0 0 1-2.52 2.523A2.528 2.528 0 0 1 0 15.165a2.527 2.527 0 0 1 2.522-2.52h2.52v2.52zM6.313 15.165a2.527 2.527 0 0 1 2.521-2.52 2.527 2.527 0 0 1 2.521 2.52v6.313A2.528 2.528 0 0 1 8.834 24a2.528 2.528 0 0 1-2.521-2.522v-6.313zM8.834 5.042a2.528 2.528 0 0 1-2.521-2.52A2.528 2.528 0 0 1 8.834 0a2.528 2.528 0 0 1 2.521 2.522v2.52H8.834zM8.834 6.313a2.528 2.528 0 0 1 2.521 2.521 2.528 2.528 0 0 1-2.521 2.521H2.522A2.528 2.528 0 0 1 0 8.834a2.528 2.528 0 0 1 2.522-2.521h6.312zM18.956 8.834a2.528 2.528 0 0 1 2.522-2.521A2.528 2.528 0 0 1 24 8.834a2.528 2.528 0 0 1-2.522 2.521h-2.522V8.834zM17.688 8.834a2.528 2.528 0 0 1-2.523 2.521 2.527 2.527 0 0 1-2.52-2.521V2.522A2.527 2.527 0 0 1 15.165 0a2.528 2.528 0 0 1 2.523 2.522v6.312zM15.165 18.956a2.528 2.528 0 0 1 2.523 2.522A2.528 2.528 0 0 1 15.165 24a2.527 2.527 0 0 1-2.52-2.522v-2.522h2.52zM15.165 17.688a2.527 2.527 0 0 1-2.52-2.523 2.526 2.526 0 0 1 2.52-2.52h6.313A2.527 2.527 0 0 1 24 15.165a2.528 2.528 0 0 1-2.522 2.523h-6.313z" fill="#E01E5A"/>
                        </svg>
                    </div>
                    <!-- Dropbox -->
                    <div class="integration-icon" title="Dropbox">
                        <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                            <path d="M12 6.13L6 9.91l6 3.78 6-3.78-6-3.78zM0 9.91l6 3.78 6-3.78-6-3.78-6 3.78zm12 7.56l-6-3.78-6 3.78 6 3.78 6-3.78zm0 0l6-3.78 6 3.78-6 3.78-6-3.78zm6-7.56l-6 3.78 6 3.78 6-3.78-6-3.78z" fill="#0061FF"/>
                        </svg>
                    </div>
                    <!-- More coming -->
                    <div class="integration-icon" title="More coming soon" style="opacity: 0.3;">
                        <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="12" r="1"></circle>
                            <circle cx="19" cy="12" r="1"></circle>
                            <circle cx="5" cy="12" r="1"></circle>
                        </svg>
                    </div>
                </div>
            </div>
        </section>

        <section class="features" id="features">
            <div class="container">
                <div class="section-header">
                    <h2>Everything you need</h2>
                    <p>One search bar to rule them all</p>
                </div>
                <div class="features-grid">
                    <div class="feature-card">
                        <div class="feature-icon">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"></path>
                                <polyline points="3.27 6.96 12 12.01 20.73 6.96"></polyline>
                                <line x1="12" y1="22.08" x2="12" y2="12"></line>
                            </svg>
                        </div>
                        <h3>Unified Search</h3>
                        <p>Search across all your connected apps simultaneously. No more switching between tabs.</p>
                    </div>
                    <div class="feature-card">
                        <div class="feature-icon">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M12 2a10 10 0 1 0 10 10H12V2z"></path>
                                <path d="M12 2a10 10 0 0 1 10 10"></path>
                                <circle cx="12" cy="12" r="6"></circle>
                            </svg>
                        </div>
                        <h3>AI-Powered</h3>
                        <p>Smart ranking and natural language understanding. Ask questions, get answers.</p>
                    </div>
                    <div class="feature-card">
                        <div class="feature-icon">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect>
                                <path d="M7 11V7a5 5 0 0 1 10 0v4"></path>
                            </svg>
                        </div>
                        <h3>Secure by Default</h3>
                        <p>Your data stays yours. We use OAuth â€” we never store your passwords or files.</p>
                    </div>
                    <div class="feature-card">
                        <div class="feature-icon">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"></polygon>
                            </svg>
                        </div>
                        <h3>Lightning Fast</h3>
                        <p>Results in milliseconds. Keyboard shortcuts for power users. Built for speed.</p>
                    </div>
                    <div class="feature-card">
                        <div class="feature-icon">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                                <circle cx="9" cy="7" r="4"></circle>
                                <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
                                <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
                            </svg>
                        </div>
                        <h3>Team Ready</h3>
                        <p>Built for small teams. Share access, manage permissions, collaborate seamlessly.</p>
                    </div>
                    <div class="feature-card">
                        <div class="feature-icon">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <circle cx="12" cy="12" r="3"></circle>
                                <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path>
                            </svg>
                        </div>
                        <h3>Easy Setup</h3>
                        <p>Connect your apps in minutes. No IT department required. Just click and go.</p>
                    </div>
                </div>
            </div>
        </section>

        <section class="how-it-works" id="how-it-works">
            <div class="container">
                <div class="section-header">
                    <h2>How it works</h2>
                    <p>Up and running in 3 minutes</p>
                </div>
                <div class="steps">
                    <div class="step">
                        <div class="step-number">1</div>
                        <h3>Connect your apps</h3>
                        <p>Link Google Drive, Notion, Gmail, and more with a single click using secure OAuth.</p>
                    </div>
                    <div class="step">
                        <div class="step-number">2</div>
                        <h3>Start searching</h3>
                        <p>Type your query in natural language. Our AI understands what you're looking for.</p>
                    </div>
                    <div class="step">
                        <div class="step-number">3</div>
                        <h3>Find anything</h3>
                        <p>Get instant results across all your connected apps, ranked by relevance.</p>
                    </div>
                </div>
            </div>
        </section>

        <section class="cta">
            <div class="container">
                <div class="cta-box">
                    <h2>Ready to find anything?</h2>
                    <p>Join the beta and never lose a document again.</p>
                    <form class="waitlist-form" id="waitlistForm" onsubmit="submitWaitlist(event)">
                        <input type="email" class="waitlist-input" id="waitlistEmail" placeholder="Enter your email" required>
                        <button type="submit" class="btn">Join Waitlist</button>
                    </form>
                    <p class="waitlist-success" id="waitlistSuccess">ðŸŽ‰ You're on the list! We'll be in touch soon.</p>
                </div>
            </div>
        </section>
    </main>

    <footer>
        <div class="container">
            <p>Â© 2026 CtrlF. Built by <a href="https://hellosrini.com" target="_blank">Srini</a>.</p>
        </div>
    </footer>

    <!-- Toast notification -->
    <div class="toast" id="toast">
        <span id="toastMessage"></span>
    </div>

    <!-- Google Identity Services -->
    <script src="https://accounts.google.com/gsi/client"></script>
    
    <script>
        // ============================================
        // CONFIGURATION
        // ============================================
        
        const CONFIG = {
            GOOGLE_CLIENT_ID: '974202437994-r86cdl80ojerktjjllgoqmj7fh3vs9vb.apps.googleusercontent.com',
            VERCEL_API_URL: 'https://ctrlf-backend.vercel.app',
            SCOPES: [
                'https://www.googleapis.com/auth/drive.readonly',
                'https://www.googleapis.com/auth/gmail.readonly',
                'https://www.googleapis.com/auth/userinfo.profile',
                'https://www.googleapis.com/auth/userinfo.email'
            ].join(' ')
        };

        // ============================================
        // STATE
        // ============================================
        
        let tokenClient;
        let accessToken = null;
        let currentUser = null;
        let selectedSources = ['drive', 'gmail', 'notion', 'slack'];
        let searchTimeout = null;

        // ============================================
        // INITIALIZATION
        // ============================================
        
        document.addEventListener('DOMContentLoaded', () => {
            initGoogleAuth();
            initSearch();
            initFilters();
            checkExistingSession();
        });

        function initGoogleAuth() {
            tokenClient = google.accounts.oauth2.initTokenClient({
                client_id: CONFIG.GOOGLE_CLIENT_ID,
                scope: CONFIG.SCOPES,
                callback: handleAuthCallback
            });
        }

        function checkExistingSession() {
            // Check if we have a stored token
            const storedToken = localStorage.getItem('ctrlf_access_token');
            const storedUser = localStorage.getItem('ctrlf_user');
            
            if (storedToken && storedUser) {
                accessToken = storedToken;
                currentUser = JSON.parse(storedUser);
                updateUIForSignedInUser();
            }
        }

        // ============================================
        // AUTHENTICATION
        // ============================================
        
        function signInWithGoogle() {
            tokenClient.requestAccessToken();
        }

        function handleAuthCallback(response) {
            if (response.error) {
                showToast('Sign in failed. Please try again.', 'error');
                return;
            }

            accessToken = response.access_token;
            localStorage.setItem('ctrlf_access_token', accessToken);
            
            // Get user info
            fetchUserInfo();
        }

        async function fetchUserInfo() {
            try {
                const response = await fetch('https://www.googleapis.com/oauth2/v2/userinfo', {
                    headers: { 'Authorization': `Bearer ${accessToken}` }
                });
                
                currentUser = await response.json();
                localStorage.setItem('ctrlf_user', JSON.stringify(currentUser));
                
                updateUIForSignedInUser();
                showToast('Signed in successfully!', 'success');
                
            } catch (error) {
                showToast('Failed to get user info', 'error');
            }
        }

        function signOut() {
            accessToken = null;
            currentUser = null;
            localStorage.removeItem('ctrlf_access_token');
            localStorage.removeItem('ctrlf_user');
            
            google.accounts.oauth2.revoke(accessToken);
            
            updateUIForSignedOutUser();
            clearResults();
            showToast('Signed out', 'success');
        }

        function updateUIForSignedInUser() {
            document.getElementById('authButtons').classList.add('hidden');
            document.getElementById('userInfo').classList.remove('hidden');
            document.getElementById('authPrompt').classList.add('hidden');
            
            document.getElementById('userAvatar').src = currentUser.picture || '';
            document.getElementById('userName').textContent = currentUser.name || currentUser.email;
            
            document.getElementById('searchInput').placeholder = 'Search your Drive and Gmail...';
        }

        function updateUIForSignedOutUser() {
            document.getElementById('authButtons').classList.remove('hidden');
            document.getElementById('userInfo').classList.add('hidden');
            document.getElementById('authPrompt').classList.remove('hidden');
            
            document.getElementById('searchInput').placeholder = 'Search across all your apps...';
        }

        // ============================================
        // SEARCH
        // ============================================
        
        function initSearch() {
            const searchInput = document.getElementById('searchInput');
            
            searchInput.addEventListener('input', (e) => {
                clearTimeout(searchTimeout);
                const query = e.target.value.trim();
                
                if (query.length >= 2) {
                    searchTimeout = setTimeout(() => performSearch(query), 300);
                } else {
                    clearResults();
                }
            });

            searchInput.addEventListener('keydown', (e) => {
                if (e.key === 'Enter') {
                    clearTimeout(searchTimeout);
                    const query = e.target.value.trim();
                    if (query) performSearch(query);
                }
            });

            // Keyboard shortcut
            document.addEventListener('keydown', (e) => {
                if ((e.metaKey || e.ctrlKey) && e.key === 'k') {
                    e.preventDefault();
                    searchInput.focus();
                }
            });
        }

        function initFilters() {
            const filterChips = document.querySelectorAll('.filter-chip');
            
            filterChips.forEach(chip => {
                chip.addEventListener('click', () => {
                    const source = chip.dataset.source;
                    
                    if (source === 'all') {
                        // Select all sources
                        selectedSources = ['drive', 'gmail', 'notion', 'slack'];
                        filterChips.forEach(c => c.classList.remove('active'));
                        chip.classList.add('active');
                    } else {
                        const allChip = document.querySelector('[data-source="all"]');
                        
                        // If "All" was selected, reset and select only this source
                        if (allChip.classList.contains('active')) {
                            selectedSources = [source];
                            filterChips.forEach(c => c.classList.remove('active'));
                            chip.classList.add('active');
                        } else {
                            // Toggle this source
                            chip.classList.toggle('active');
                            
                            if (chip.classList.contains('active')) {
                                if (!selectedSources.includes(source)) {
                                    selectedSources.push(source);
                                }
                            } else {
                                selectedSources = selectedSources.filter(s => s !== source);
                            }
                            
                            // If nothing selected, go back to All
                            if (selectedSources.length === 0) {
                                selectedSources = ['drive', 'gmail', 'notion', 'slack'];
                                allChip.classList.add('active');
                            }
                        }
                    }
                    
                    console.log('Selected sources:', selectedSources); // Debug
                    
                    // Re-run search if there's a query
                    const query = document.getElementById('searchInput').value.trim();
                    if (query) performSearch(query);
                });
            });
        }

        let searchVersion = 0;

        async function performSearch(query) {
            if (!accessToken) {
                showToast('Please sign in to search', 'error');
                return;
            }

            // Increment version to cancel any pending searches
            const thisSearch = ++searchVersion;
            
            showLoading(true);
            clearResults();
            hideAIAnswer();

            try {
                const currentSources = [...selectedSources]; // Snapshot current filters
                console.log('Searching with sources:', currentSources);
                const results = await searchWithAPI(query, currentSources);
                
                // Only display if this is still the current search
                if (thisSearch === searchVersion) {
                    displayResults(results);
                    
                    // Get AI answer if we have results
                    if (results.results && results.results.length > 0) {
                        getAIAnswer(query, results);
                    }
                } else {
                    console.log('Ignoring stale search results');
                }
            } catch (error) {
                console.error('Search error:', error);
                if (thisSearch === searchVersion) {
                    showToast('Search failed. Please try again.', 'error');
                }
            } finally {
                if (thisSearch === searchVersion) {
                    showLoading(false);
                }
            }
        }

        function hideAIAnswer() {
            document.getElementById('aiAnswer').style.display = 'none';
        }

        async function getAIAnswer(question, searchResults) {
            const aiAnswerDiv = document.getElementById('aiAnswer');
            const aiContentDiv = document.getElementById('aiAnswerContent');
            const aiSourcesDiv = document.getElementById('aiAnswerSources');
            
            // Show loading state
            aiAnswerDiv.style.display = 'block';
            aiContentDiv.innerHTML = '<div class="ai-loading"><div class="spinner"></div> Generating answer...</div>';
            aiSourcesDiv.innerHTML = '';
            
            // Build context from search results
            let context = '';
            const sourcesList = [];
            
            for (const result of searchResults.results.slice(0, 10)) { // Limit to top 10 results
                if (result.content) {
                    context += `\n\n[${result.source.toUpperCase()}: ${result.name}]\n${result.content}`;
                    sourcesList.push(`${result.source}: ${result.name}`);
                } else if (result.snippet) {
                    context += `\n\n[${result.source.toUpperCase()}: ${result.name}]\n${result.snippet}`;
                    sourcesList.push(`${result.source}: ${result.name}`);
                }
                
                // For Drive files, try to get content
                if (result.source === 'drive' && result.type && !result.content) {
                    try {
                        const content = await getDriveFileContent(result.id, result.type);
                        if (content) {
                            context += `\n\n[DRIVE: ${result.name}]\n${content}`;
                            sourcesList.push(`Drive: ${result.name}`);
                        }
                    } catch (e) {
                        console.log('Could not get Drive file content:', e);
                    }
                }
            }
            
            if (!context.trim()) {
                aiContentDiv.innerHTML = 'Found files but couldn\'t read their content. Click on the results below to view them.';
                return;
            }
            
            try {
                const response = await fetch(`${CONFIG.VERCEL_API_URL}/api/search?action=answer`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ question, context: context.substring(0, 15000) })
                });
                
                const data = await response.json();
                
                if (data.error) {
                    aiContentDiv.innerHTML = 'Could not generate AI answer: ' + data.error;
                } else if (data.answer) {
                    aiContentDiv.innerHTML = data.answer.replace(/\n/g, '<br>');
                    if (sourcesList.length > 0) {
                        aiSourcesDiv.innerHTML = '<strong>Sources:</strong> ' + [...new Set(sourcesList)].slice(0, 5).join(' â€¢ ');
                    }
                }
            } catch (error) {
                console.error('AI answer error:', error);
                aiContentDiv.innerHTML = 'Could not generate AI answer. View the results below.';
            }
        }

        async function getDriveFileContent(fileId, mimeType) {
            // For Google Docs/Sheets/Slides, export as text
            if (mimeType.includes('google-apps.document')) {
                const response = await fetch(
                    `https://www.googleapis.com/drive/v3/files/${fileId}/export?mimeType=text/plain`,
                    { headers: { 'Authorization': `Bearer ${accessToken}` } }
                );
                const text = await response.text();
                return text.substring(0, 3000);
            }
            if (mimeType.includes('google-apps.spreadsheet')) {
                const response = await fetch(
                    `https://www.googleapis.com/drive/v3/files/${fileId}/export?mimeType=text/csv`,
                    { headers: { 'Authorization': `Bearer ${accessToken}` } }
                );
                const text = await response.text();
                return text.substring(0, 3000);
            }
            // For PDFs and other files, we'd need server-side processing
            return null;
        }

        async function searchWithAPI(query, sources) {
            console.log('searchWithAPI called with sources:', sources);
            const results = {
                query: query,
                results: [],
                timestamp: new Date().toISOString()
            };

            // Search Drive (direct API - no CORS issues)
            if (sources.includes('drive')) {
                console.log('Searching Drive...');
                try {
                    const driveResults = await searchDriveDirect(query);
                    driveResults.forEach(file => {
                        results.results.push({
                            source: 'drive',
                            type: file.mimeType,
                            id: file.id,
                            name: file.name,
                            url: file.webViewLink,
                            modified: file.modifiedTime,
                            snippet: file.description || ''
                        });
                    });
                } catch (e) {
                    console.error('Drive search error:', e);
                }
            }

            // Search Gmail (direct API - no CORS issues)
            if (sources.includes('gmail')) {
                try {
                    const gmailResults = await searchGmailDirect(query);
                    gmailResults.forEach(msg => {
                        results.results.push({
                            source: 'gmail',
                            type: 'email',
                            id: msg.id,
                            name: msg.subject,
                            url: `https://mail.google.com/mail/u/0/#inbox/${msg.id}`,
                            modified: msg.date,
                            snippet: msg.snippet,
                            from: msg.from
                        });
                    });
                } catch (e) {
                    console.error('Gmail search error:', e);
                }
            }

            // Search Notion (via Vercel backend)
            if (sources.includes('notion') && CONFIG.VERCEL_API_URL && CONFIG.VERCEL_API_URL !== 'YOUR_VERCEL_URL_HERE') {
                try {
                    const notionResults = await searchNotionViaVercel(query);
                    if (notionResults.pages) {
                        notionResults.pages.forEach(page => {
                            results.results.push({
                                source: 'notion',
                                type: 'page',
                                id: page.id,
                                name: page.title,
                                url: page.url,
                                modified: page.lastEdited,
                                snippet: ''
                            });
                        });
                    }
                } catch (e) {
                    console.error('Notion search error:', e);
                }
            }

            // Search Slack (via Vercel backend)
            if (sources.includes('slack') && CONFIG.VERCEL_API_URL && CONFIG.VERCEL_API_URL !== 'YOUR_VERCEL_URL_HERE') {
                try {
                    const slackResults = await searchSlackViaVercel(query);
                    if (slackResults.messages) {
                        slackResults.messages.forEach(msg => {
                            results.results.push({
                                source: 'slack',
                                type: 'message',
                                id: msg.ts,
                                name: msg.channel,
                                url: msg.permalink || '#',
                                modified: new Date(parseFloat(msg.ts) * 1000).toISOString(),
                                snippet: msg.text,
                                from: msg.username
                            });
                        });
                    }
                } catch (e) {
                    console.error('Slack search error:', e);
                }
            }

            // Sort by date
            results.results.sort((a, b) => new Date(b.modified) - new Date(a.modified));
            results.totalResults = results.results.length;

            return results;
        }

        // Backend functions disabled due to CORS - will use alternative approach
        // async function searchNotionViaBackend(query) { ... }
        // async function searchSlackViaBackend(query) { ... }

        async function searchNotionViaVercel(query) {
            const response = await fetch(`${CONFIG.VERCEL_API_URL}/api/search?source=notion&query=${encodeURIComponent(query)}`);
            return await response.json();
        }

        async function searchSlackViaVercel(query) {
            const response = await fetch(`${CONFIG.VERCEL_API_URL}/api/search?source=slack&query=${encodeURIComponent(query)}`);
            return await response.json();
        }

        async function searchDriveDirect(query) {
            const searchQuery = encodeURIComponent(`(name contains '${query}' or fullText contains '${query}') and trashed = false`);
            const url = `https://www.googleapis.com/drive/v3/files?q=${searchQuery}&pageSize=20&fields=files(id,name,mimeType,webViewLink,modifiedTime,description)&orderBy=modifiedTime desc`;
            
            const response = await fetch(url, {
                headers: { 'Authorization': `Bearer ${accessToken}` }
            });
            
            const data = await response.json();
            return data.files || [];
        }

        async function searchGmailDirect(query) {
            const url = `https://www.googleapis.com/gmail/v1/users/me/messages?q=${encodeURIComponent(query)}&maxResults=10`;
            
            const response = await fetch(url, {
                headers: { 'Authorization': `Bearer ${accessToken}` }
            });
            
            const data = await response.json();
            
            if (!data.messages) return [];

            // Fetch details for each message
            const messages = await Promise.all(
                data.messages.map(msg => getGmailMessageDetails(msg.id))
            );
            
            return messages.filter(m => m !== null);
        }

        async function getGmailMessageDetails(messageId) {
            try {
                const url = `https://www.googleapis.com/gmail/v1/users/me/messages/${messageId}?format=metadata&metadataHeaders=Subject&metadataHeaders=From&metadataHeaders=Date`;
                
                const response = await fetch(url, {
                    headers: { 'Authorization': `Bearer ${accessToken}` }
                });
                
                const data = await response.json();
                
                const headers = {};
                if (data.payload && data.payload.headers) {
                    data.payload.headers.forEach(h => {
                        headers[h.name.toLowerCase()] = h.value;
                    });
                }
                
                return {
                    id: data.id,
                    subject: headers['subject'] || '(No Subject)',
                    from: headers['from'] || '',
                    date: headers['date'] || '',
                    snippet: data.snippet || ''
                };
            } catch (e) {
                return null;
            }
        }

        // ============================================
        // RESULTS DISPLAY
        // ============================================
        
        function displayResults(data) {
            const container = document.getElementById('resultsContainer');
            const list = document.getElementById('resultsList');
            const count = document.getElementById('resultsCount');
            const hint = document.getElementById('searchHint');

            if (!data.results || data.results.length === 0) {
                count.textContent = 'No results found';
                list.innerHTML = '<p style="text-align: center; color: var(--text-muted); padding: 40px;">No matching files or emails found. Try a different search term.</p>';
                container.classList.add('visible');
                hint.classList.add('hidden');
                return;
            }

            count.textContent = `${data.results.length} result${data.results.length === 1 ? '' : 's'}`;
            
            list.innerHTML = data.results.map(result => {
                const icon = getFileIcon(result.type);
                const date = result.modified ? new Date(result.modified).toLocaleDateString() : '';
                
                return `
                    <a href="${result.url}" target="_blank" class="result-item">
                        <div class="result-header">
                            <span class="result-icon">${icon}</span>
                            <span class="result-source ${result.source}">${result.source}</span>
                        </div>
                        <div class="result-title">${escapeHtml(result.name)}</div>
                        ${result.snippet ? `<div class="result-snippet">${escapeHtml(result.snippet)}</div>` : ''}
                        <div class="result-meta">
                            ${result.from ? `<span>From: ${escapeHtml(result.from.split('<')[0].trim())}</span>` : ''}
                            ${date ? `<span>${date}</span>` : ''}
                        </div>
                    </a>
                `;
            }).join('');

            container.classList.add('visible');
            hint.classList.add('hidden');
        }

        function clearResults() {
            document.getElementById('resultsContainer').classList.remove('visible');
            document.getElementById('resultsList').innerHTML = '';
            document.getElementById('searchHint').classList.remove('hidden');
            document.getElementById('aiAnswer').style.display = 'none';
        }

        function getFileIcon(mimeType) {
            if (!mimeType) return 'ðŸ“Ž';
            if (mimeType === 'email') return 'âœ‰ï¸';
            if (mimeType === 'page') return 'ðŸ“';
            if (mimeType === 'message') return 'ðŸ’¬';
            if (mimeType.includes('document') || mimeType.includes('word')) return 'ðŸ“„';
            if (mimeType.includes('spreadsheet') || mimeType.includes('excel')) return 'ðŸ“Š';
            if (mimeType.includes('presentation') || mimeType.includes('powerpoint')) return 'ðŸ“½ï¸';
            if (mimeType.includes('pdf')) return 'ðŸ“•';
            if (mimeType.includes('image')) return 'ðŸ–¼ï¸';
            if (mimeType.includes('video')) return 'ðŸŽ¬';
            if (mimeType.includes('audio')) return 'ðŸŽµ';
            if (mimeType.includes('folder')) return 'ðŸ“';
            return 'ðŸ“Ž';
        }

        // ============================================
        // WAITLIST
        // ============================================
        
        async function submitWaitlist(e) {
            e.preventDefault();
            
            const email = document.getElementById('waitlistEmail').value.trim();
            
            if (!email) return;

            try {
                // If backend is configured, use it
                if (CONFIG.BACKEND_URL && CONFIG.BACKEND_URL !== 'YOUR_APPS_SCRIPT_URL_HERE') {
                    await fetch(CONFIG.BACKEND_URL, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            action: 'waitlist',
                            email: email
                        })
                    });
                }
                
                // Show success
                document.getElementById('waitlistForm').classList.add('hidden');
                document.getElementById('waitlistSuccess').classList.add('visible');
                showToast('You\'re on the list!', 'success');
                
            } catch (error) {
                // Still show success (email captured client-side intent)
                document.getElementById('waitlistForm').classList.add('hidden');
                document.getElementById('waitlistSuccess').classList.add('visible');
            }
        }

        // ============================================
        // UI HELPERS
        // ============================================
        
        function showLoading(show) {
            document.getElementById('loadingState').classList.toggle('visible', show);
        }

        function showToast(message, type = 'success') {
            const toast = document.getElementById('toast');
            const toastMessage = document.getElementById('toastMessage');
            
            toastMessage.textContent = message;
            toast.className = `toast ${type} visible`;
            
            setTimeout(() => {
                toast.classList.remove('visible');
            }, 3000);
        }

        function escapeHtml(text) {
            if (!text) return '';
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // Smooth scroll for anchor links
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                const target = document.querySelector(this.getAttribute('href'));
                if (target) {
                    target.scrollIntoView({ behavior: 'smooth' });
                }
            });
        });
    </script>
</body>
</html>
